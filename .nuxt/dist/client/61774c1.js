(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{455:function(e,t,n){var content=n(457);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(18).default)("10f43ecd",content,!0,{sourceMap:!1})},456:function(e,t,n){"use strict";n(455)},457:function(e,t,n){(t=n(17)(!1)).push([e.i,".split-wrapper{display:flex;align-items:center}.split-wrapper .icon{font-size:1.4rem}.split-wrapper .desc{font-size:13px;font-weight:700;padding:0 10px 0 5px;letter-spacing:2px;text-transform:uppercase}.split-wrapper .split{flex:1;height:1px;background-color:var(--border-color)}",""]),e.exports=t},458:function(e,t,n){"use strict";var r={props:{icon:String,desc:String},methods:{getIcon:function(e){return/icon/.test(e)?e:"icon-"+e}}},o=(n(456),n(4)),component=Object(o.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"split-wrapper"},[e.icon?n("i",{staticClass:"icon",class:e.getIcon(e.icon)}):e._e(),e._v(" "),e.desc?n("span",{staticClass:"desc"},[e._v(e._s(e.desc))]):e._e(),e._v(" "),n("div",{staticClass:"split"})])}),[],!1,null,null,null);t.a=component.exports},460:function(e,t,n){var content=n(470);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(18).default)("30b81a99",content,!0,{sourceMap:!1})},462:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return l})),n.d(t,"d",(function(){return d}));n(35),n(36),n(8);var r=n(2).a.prototype.$isServer,o=function(){if(!r&&document.addEventListener)return function(element,e,t){element&&e&&t&&element.addEventListener(e,t,!1)}}(),c=function(){if(!r&&document.removeEventListener)return function(element,e,t){element&&e&&t&&element.removeEventListener(e,t,!1)}}(),l=function(element){var e=0,t=element.ownerDocument||element.document,n=t.defaultView||t.parentWindow;if(n.getSelection().rangeCount>0){var r=n.getSelection().getRangeAt(0),o=r.cloneRange();o.selectNodeContents(element),o.setEnd(r.endContainer,r.endOffset),e=o.toString().length}return e},d=function(element,e){var t=document.createRange();if(!(element.firstChild.length<e)){t.setStart(element.firstChild,e),t.setEnd(element.firstChild,e);var n=window.getSelection();n.removeAllRanges(),n.addRange(t)}}},466:function(e,t,n){"use strict";var r=n(468),o=n.n(r),c=n(100),l=n(104);t.a=function(e){return e&&c.a.validateEmail(e)?l.a.url(e,{protocol:"https"}):o.a}},467:function(e,t,n){var r=n(12);r(r.S,"Object",{is:n(224)})},468:function(e,t,n){e.exports=n.p+"img/default.8d326fe.png"},469:function(e,t,n){"use strict";n(460)},470:function(e,t,n){(t=n(17)(!1)).push([e.i,'.fade-transform-enter-active[data-v-2945e851],.fade-transform-leave-active[data-v-2945e851]{transition:all .5s}.fade-transform-enter[data-v-2945e851]{opacity:0;transform:translateX(-30px)}.fade-transform-leave-to[data-v-2945e851]{opacity:0;transform:translateX(30px)}.mobile-slide-enter-active[data-v-2945e851],.mobile-slide-leave-active[data-v-2945e851]{transition:all .2s ease-in-out}.mobile-slide-enter[data-v-2945e851],.mobile-slide-leave-to[data-v-2945e851]{transform:translateX(100%)}.search-slide-enter-active[data-v-2945e851],.search-slide-leave-active[data-v-2945e851]{transition:all .35s ease-in-out}@media (max-width:1024px){.search-slide-enter-active[data-v-2945e851],.search-slide-leave-active[data-v-2945e851]{transition:all .25s ease-in-out}}.search-slide-enter[data-v-2945e851],.search-slide-leave-to[data-v-2945e851]{transform:translateX(100%)}.fade-enter-active[data-v-2945e851],.fade-leave-active[data-v-2945e851]{transition:opacity .3s}.fade-enter[data-v-2945e851],.fade-leave-active[data-v-2945e851]{opacity:0}.fade-move[data-v-2945e851]{transition:transform .3s}.fade-leave-active[data-v-2945e851]{position:absolute}.list-slide-enter[data-v-2945e851],.list-slide-leave-to[data-v-2945e851]{opacity:0;transform:translateY(30px)}.list-slide-leave-active[data-v-2945e851]{width:100%;position:absolute}.slide-up-enter-active[data-v-2945e851]{transition:all .3s ease .1s}.slide-up-leave-active[data-v-2945e851]{transition:all .3s ease}.slide-up-enter[data-v-2945e851],.slide-up-leave-active[data-v-2945e851]{transform:translateY(-20px);opacity:0}.slide-up-move[data-v-2945e851]{transition:all .5s}.editor-container[data-v-2945e851]{display:flex;justify-content:space-between;align-items:flex-start}.avatar[data-v-2945e851]{display:inline-block;width:36px;height:36px;border-radius:50%;background-color:#eee}@media (max-width:480px){.avatar[data-v-2945e851]{display:none}}.slide-wrapper[data-v-2945e851]{position:relative}.message-container .comment-wrapper[data-v-2945e851]{width:100%}.message-container .slide-wrapper[data-v-2945e851]{display:flex;flex-direction:column}.message-container .slide-wrapper .user-item[data-v-2945e851]{order:1;margin:5px 0 10px}@media (max-width:480px){.message-container .slide-wrapper .user-item .user-input[data-v-2945e851]{width:calc(100% - 20px)}}.message-container .slide-wrapper .editor-item[data-v-2945e851]{order:2}.message-container .slide-wrapper .tools-item[data-v-2945e851]{order:3}.comment-wrapper[data-v-2945e851]{width:calc(100% - 50px)}@media (max-width:480px){.comment-wrapper[data-v-2945e851]{width:100%}}.comment-wrapper .list-slide-item[data-v-2945e851]{transition:all .3s ease-in-out}.comment-wrapper .reply-target[data-v-2945e851]{box-sizing:border-box;position:relative;margin-bottom:10px;padding:10px;border:1px solid var(--border-color);border-radius:4px}.comment-wrapper .reply-target .icon-ant-close[data-v-2945e851]{display:flex;justify-content:center;align-items:center;position:absolute;top:5px;right:5px;width:30px;height:30px;font-size:20px;cursor:pointer}.comment-wrapper .reply-target .icon-ant-close[data-v-2945e851]:hover{color:var(--theme-active)}.comment-wrapper .editor[data-v-2945e851]{box-sizing:border-box;width:100%;min-height:6em;max-height:30em;padding:10px;font-size:1rem;color:var(--font-color-article);border:1px solid var(--border-color);border-radius:4px;outline:none;overflow-y:auto;transition:all .1s linear;font-family:Microsoft Yahei}.comment-wrapper .editor[data-v-2945e851]:empty:before{content:attr(placeholder);white-space:pre-wrap}.comment-wrapper .editor dt[data-v-2945e851]:before{content:"\\D\\A";white-space:pre}.comment-wrapper .editor dt[data-v-2945e851]:first-child:before{content:normal}.comment-wrapper .editor[data-v-2945e851]:focus,.comment-wrapper .editor[data-v-2945e851]:hover{border-color:var(--font-color-light)}.comment-wrapper .editor[data-v-2945e851]:focus:before{content:none}.comment-wrapper .user-wrapper[data-v-2945e851]{display:flex;align-items:center;font-size:1rem}@media (max-width:768px){.comment-wrapper .user-wrapper[data-v-2945e851]{flex-direction:column}}.comment-wrapper .user-wrapper .user-input[data-v-2945e851]{width:calc(32% - 20px);height:1em;margin-right:1em;line-height:normal;padding:8px 10px;outline:none;color:var(--font-color-article);white-space:nowrap;border:1px solid var(--border-color);border-radius:4px;background-color:var(--app-background-color);transition:all .1s linear;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.comment-wrapper .user-wrapper .user-input[data-v-2945e851]:focus,.comment-wrapper .user-wrapper .user-input[data-v-2945e851]:hover{border-color:var(--font-color-light)}@media (max-width:768px){.comment-wrapper .user-wrapper .user-input[data-v-2945e851]{width:calc(100% - 20px);margin:3px 5px}}.tools-wrapper[data-v-2945e851]{display:flex;justify-content:space-between;align-items:center}.tools-wrapper .tool-item[data-v-2945e851]{display:flex;justify-content:center;align-items:center;width:30px;height:30px;cursor:pointer;transition:all .1s linear}.tools-wrapper .tool-item[data-v-2945e851]:hover{background-color:var(--tool-background-color)}.editor-tools[data-v-2945e851]{display:flex;justify-content:flex-start;transition:all .1s linear;margin:5px 0}.editor-tools>a[data-v-2945e851]{position:relative;margin-right:10px}.editor-tools>a[data-v-2945e851]:last-child{margin-right:0}.emoji-wrapper[data-v-2945e851]{box-sizing:border-box;display:flex;justify-content:flex-start;flex-wrap:wrap;position:absolute;top:30px;left:0;width:200px;padding:10px;background-color:var(--code-background);z-index:1;cursor:default}.emoji-wrapper .emoji-item[data-v-2945e851]{display:flex;justify-content:center;align-items:center;box-sizing:border-box;font-size:20px;width:36px;height:36px}.emoji-wrapper .emoji-item[data-v-2945e851]:hover{background-color:var(--tool-background-color);cursor:pointer}',""]),e.exports=t},474:function(e,t,n){"use strict";n(35),n(36),n(8),n(101),n(54),n(467);var r=n(139),o=n(100),c=n(140),l=n.n(c),d=n(462),m=n(466),v=["😃","😂","😅","😉","😌","😔","😓","😘","😡","😭","😱","😳","😵","🌚","👍","👎","💪","🌹","💊"],f={props:{placeholder:{type:String},isShowReplyContent:{type:Boolean,default:!1},isMessageEditor:{type:Boolean,default:!1}},data:function(){return{isShowEmoji:!1,contentText:"",contentHtml:"",form:{nickname:"",content:"",email:""},reply:{replyNickname:"",replyContent:""},emojiList:v,cursorPosition:0}},directives:{ClickOutside:l.a},computed:{avatar:function(){return Object(m.a)(this.form.email)}},methods:{resetField:function(){this.form.content="",this.contentText="",this.contentHtml="",this.$refs.editContent.innerHTML="",this.$refs.editContent.innerText="",this.cursorPosition=0},closeReplyContent:function(){this.$emit("closeReplyContent")},contentChange:function(){var html=this.$refs.editContent.innerHTML,text=this.$refs.editContent.innerText;Object.is(html,this.comemntContentHtml)||(this.contentHtml=html),Object.is(text,this.comemntContentText)||(this.contentText=text),this.cursorPosition=Object(d.a)(this.$refs.editContent)},getCursorPosition:function(){this.cursorPosition=Object(d.a)(this.$refs.editContent)},send:function(){this.contentChange();var e=this.getInValidMsg();if(e)alert(e);else{var t={nickname:this.form.nickname,email:this.form.email,website:this.form.website};window.localStorage.setItem("USER",JSON.stringify(t)),this.$emit("send",this.form)}},getInValidMsg:function(){return this.form.content=this.contentText,this.form.email?!1===o.a.validateEmail(this.form.email)?"请填写正确的email格式":this.form.content&&this.form.content.replace(/\s/g,"")?(!this.form.nickname||this.form.nickname.length>32)&&"昵称不能为空且长度不能超过32个字符":this.form.content.length>1e3||this.form.content.split("\n").length>30?"".concat(this.isMessageEditor?"留言":"评论","内容不能超过1000个字且控制在30行以内"):this.isMessageEditor?"留言内容不能为空":"评论内容不能为空":"邮箱不能为空"},insertContent:function(e){this.updateEditContent({image:{start:"![",end:"]()"},link:{start:"[",end:"]()"},code:{start:"\n```\n",end:"\n```"}}[e])},insertEmoji:function(e){var t=this.$refs.editContent,text=t.innerText;t.innerText=text.slice(0,this.cursorPosition)+"".concat(e)+text.slice(this.cursorPosition,text.length),Object(d.d)(t,this.cursorPosition+2),this.cursorPosition=Object(d.a)(t)+2,this.contentChange()},updateEditContent:function(e){var t=e.start,n=void 0===t?"":t,r=e.end,o=void 0===r?"":r;if(n||o){var c=this.$refs.editContent,l=(window.getSelection||document.getSelection)().toString(),d=c.innerText;if(l){var m=d.replace(l,n+l+o);c.innerText=m}else c.innerText=c.innerText+=n+o}}},created:function(){var e=this;this.debouncedSend=Object(r.debounce)(1e3,!0,(function(){e.send()}));var t=window.localStorage.getItem("USER");t&&(t=JSON.parse(t),this.form.nickname=t.nickname||"",this.form.email=t.email||"",this.form.website=t.website||"")}},h=(n(469),n(4)),component=Object(h.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"editor-container",class:{"message-container":e.isMessageEditor}},[e.isMessageEditor?e._e():n("img",{staticClass:"avatar",attrs:{src:e.avatar,alt:e.form.nickname||"匿名用户"}}),e._v(" "),n("section",{staticClass:"comment-wrapper"},[n("transition-group",{staticClass:"slide-wrapper",attrs:{tag:"div",name:"list-slide"}},[e.isShowReplyContent?n("section",{key:1,staticClass:"list-slide-item reply-item"},[n("div",{staticClass:"reply-target"},[n("i",{staticClass:"icon icon-ant-close",on:{click:e.closeReplyContent}}),e._v(" "),n("strong",{staticClass:"reply-author"},[e._v("@"+e._s(e.reply.nickname))]),e._v(" "),n("div",{staticClass:"reply-content markdown",domProps:{innerHTML:e._s(e.reply.content)}})])]):e._e(),e._v(" "),n("section",{key:2,staticClass:"list-slide-item editor-item"},[n("div",{ref:"editContent",staticClass:"editor",attrs:{contenteditable:"true",placeholder:e.placeholder||(e.isMessageEditor?"我想说...":"评论...")},on:{keyup:e.contentChange,click:e.getCursorPosition}})]),e._v(" "),n("section",{key:3,staticClass:"list-slide-item tools-wrapper tools-item"},[n("div",{staticClass:"editor-tools"},[n("a",{directives:[{name:"click-outside",rawName:"v-click-outside",value:function(){e.isShowEmoji=!1},expression:"() => {isShowEmoji = false}"}],staticClass:"tool-item",on:{click:function(t){e.isShowEmoji=!0}}},[n("i",{staticClass:"icon icon-smile"}),e._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:e.isShowEmoji,expression:"isShowEmoji"}],staticClass:"emoji-wrapper"},e._l(e.emojiList,(function(t,r){return n("li",{key:r,staticClass:"emoji-item",on:{click:function(n){return n.stopPropagation(),e.insertEmoji(t)}}},[e._v("\n                                "+e._s(t)+"\n                            ")])})),0)]),e._v(" "),n("a",{staticClass:"tool-item",on:{click:function(t){return e.insertContent("image")}}},[n("i",{staticClass:"icon icon-image"})]),e._v(" "),n("a",{staticClass:"tool-item",on:{click:function(t){return e.insertContent("link")}}},[n("i",{staticClass:"icon icon-link"})]),e._v(" "),n("a",{staticClass:"tool-item",on:{click:function(t){return e.insertContent("code")}}},[n("i",{staticClass:"icon icon-code"})])]),e._v(" "),n("a",{staticClass:"tool-item",on:{click:e.debouncedSend}},[n("i",{staticClass:"icon icon-send"})])]),e._v(" "),n("div",{key:4,staticClass:"list-slide-item user-item"},[n("section",{staticClass:"user-wrapper"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.form.nickname,expression:"form.nickname"}],staticClass:"user-input",attrs:{maxlength:"32",name:"text",required:!0,type:"text",placeholder:"昵称（必填）"},domProps:{value:e.form.nickname},on:{input:function(t){t.target.composing||e.$set(e.form,"nickname",t.target.value)}}}),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.form.email,expression:"form.email"}],staticClass:"user-input",attrs:{name:"email",type:"email",placeholder:"邮箱（必填）"},domProps:{value:e.form.email},on:{input:function(t){t.target.composing||e.$set(e.form,"email",t.target.value)}}})])])])],1)])}),[],!1,null,"2945e851",null);t.a=component.exports},485:function(e,t,n){var content=n(506);"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(18).default)("2551f70a",content,!0,{sourceMap:!1})},505:function(e,t,n){"use strict";n(485)},506:function(e,t,n){(t=n(17)(!1)).push([e.i,".reply-wrapper[data-v-37e2d702]{box-sizing:border-box;padding:6px 10px;font-size:14px;border:1px solid var(--border-color);border-radius:4px;background-color:var(--primary-light-0)}.reply-wrapper .reply-nickname[data-v-37e2d702]{font-weight:700}.messages-container[data-v-37e2d702]{width:100%;max-width:1200px;margin:0 auto;z-index:1;box-sizing:border-box}@media (max-width:1440px){.messages-container[data-v-37e2d702]{padding:0 85px}}@media (max-width:1024px){.messages-container[data-v-37e2d702]{padding:0 60px}}@media (max-width:768px){.messages-container[data-v-37e2d702]{padding:0 35px}}@media (max-width:480px){.messages-container[data-v-37e2d702]{padding:0 15px}}.messages-container .editor-wrapper[data-v-37e2d702]{margin:.5em}.messages-wrapper[data-v-37e2d702]{display:flex;flex-wrap:wrap}.messages-wrapper .message-item[data-v-37e2d702]{display:flex;flex-direction:column;width:100%;margin:.4em .5em;padding:1em;border-radius:4px;transition:all .25s ease-in-out;border:1px solid var(--border-color)}@media (max-width:480px){.messages-wrapper .message-item[data-v-37e2d702]{margin:.2em .5em;padding:.5em}}.messages-wrapper .message-item[data-v-37e2d702]:hover{transform:translateY(-2px)}.messages-wrapper .message-item .nickname[data-v-37e2d702]{height:24px;font-size:14px;font-weight:700}.messages-wrapper .message-item .content[data-v-37e2d702]{flex:1;font-size:14px}.messages-wrapper .message-item .content img[data-v-37e2d702]{width:50%}.messages-wrapper .message-item .time[data-v-37e2d702]{font-size:14px;text-align:right}.load-more[data-v-37e2d702]{box-sizing:border-box;width:40px;height:40px;margin:10px auto 0;border:8px solid #dcdfe7;border-radius:50%;transition:all .25s ease-in-out;cursor:pointer}@media (max-width:480px){.load-more[data-v-37e2d702]{width:30px;height:30px;border-width:5px}}.load-more[data-v-37e2d702]:hover{border-color:var(--theme-active);background-color:var(--theme-active);transform:scale(.65)}",""]),e.exports=t},539:function(e,t,n){"use strict";n.r(t);n(22),n(11),n(10),n(8),n(20);var r=n(6),o=(n(5),n(0)),c=n(458),l=n(474),d=n(26),m=n(7);function v(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function f(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?v(Object(source),!0).forEach((function(t){Object(r.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):v(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}var h={name:"messages-page",components:{SplitLine:c.a,CommentEditor:l.a},head:function(){return{title:"留言墙"}},fetch:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.store,e.params,t.next=3,n.dispatch("message/getMessages",{page:0,count:10});case 3:case"end":return t.stop()}}),t)})))()},data:function(){return{page:0}},computed:f(f({},Object(m.c)({messages:function(e){return e.message.messages},total:function(e){return e.message.total},loading:function(e){return e.message.loading}})),{},{isLoadMore:function(){return!(!this.messages.length||this.loading)&&this.total>this.messages.length}}),watch:{messages:function(){var e=this;this.$nextTick((function(){e.initImage()}))}},methods:{marked:function(content){return Object(d.a)(content)},loadMore:function(){this.loading||(this.page++,this.$store.dispatch("message/getMoreMessages",{page:this.page}))},initImage:function(){n.e(0).then(n.bind(null,533)).then((function(e){e.default(".image-popper")}))},onSend:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var r,content,o,c;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.nickname,content=e.content,o=e.email,n.prev=1,n.next=4,t.$store.dispatch("message/createMessage",{nickname:r,email:o,content:content});case 4:(c=n.sent)&&1===c.code&&(t.$refs.editor.resetField(),t.$store.dispatch("message/getMessages",{page:0,count:10})),n.next=10;break;case 8:n.prev=8,n.t0=n.catch(1);case 10:case"end":return n.stop()}}),n,null,[[1,8]])})))()}},mounted:function(){this.initImage()}},x=(n(505),n(4)),component=Object(x.a)(h,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"messages-container"},[n("split-line",{attrs:{icon:"message",desc:"留言墙"}}),e._v(" "),n("section",{staticClass:"editor-wrapper"},[n("comment-editor",{ref:"editor",attrs:{isMessageEditor:!0},on:{send:e.onSend}})],1),e._v(" "),n("ul",{staticClass:"messages-wrapper markdown"},e._l(e.messages,(function(t){return n("li",{key:t.id,staticClass:"message-item"},[t.nickname?n("span",{staticClass:"nickname"},[e._v(e._s(t.nickname))]):e._e(),e._v(" "),n("div",{staticClass:"content"},[n("p",{domProps:{innerHTML:e._s(e.marked(t.content))}}),e._v(" "),t.reply?n("section",{staticClass:"reply-wrapper markdown"},[e._m(0,!0),e._v(" "),n("div",{domProps:{innerHTML:e._s(e.marked(t.reply))}})]):e._e()]),e._v(" "),n("time",{staticClass:"time",attrs:{datetime:e._f("filterTime")(t.create_time)}},[e._v(e._s(e._f("filterTime")(t.create_time))+"\n            ")])])})),0),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.isLoadMore,expression:"isLoadMore"}],staticClass:"load-more",on:{click:e.loadMore}}),e._v(" "),n("loading",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}]}),e._v(" "),e.loading||e.messages.length?e._e():n("empty",{attrs:{message:"还没有留言 /(ㄒoㄒ)/~~",isBack:!1}})],1)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"reply-nickname"},[t("i",{staticClass:"iconfont iconzuozhe"}),this._v("：")])}],!1,null,"37e2d702",null);t.default=component.exports}}]);