{"version":3,"file":"pages/messages/index.js","sources":["webpack:///./components/base/split-line/split-line.vue?729e","webpack:///./components/base/split-line/split-line.vue?1f7a","webpack:///./components/base/split-line/split-line.vue?ae1b","webpack:///./components/base/split-line/split-line.vue?3776","webpack:///./components/base/split-line/split-line.vue","webpack:///./components/base/split-line/split-line.vue?6ed9","webpack:///./components/base/split-line/split-line.vue?37f2","webpack:///./components/base/comment-editor/comment-editor.vue?0acd","webpack:///./services/utils/dom.js","webpack:///./services/gravatar/gravatar.js","webpack:///./assets/image/default.png","webpack:///./components/base/comment-editor/comment-editor.vue?3148","webpack:///./components/base/comment-editor/comment-editor.vue?1179","webpack:///./components/base/comment-editor/comment-editor.vue?8550","webpack:///./components/base/comment-editor/comment-editor.vue","webpack:///./components/base/comment-editor/comment-editor.vue?fe3e","webpack:///./components/base/comment-editor/comment-editor.vue?8673","webpack:///./pages/messages/index.vue?7a6f","webpack:///./pages/messages/index.vue?719d","webpack:///./pages/messages/index.vue?1b37","webpack:///./pages/messages/index.vue?a65e","webpack:///./pages/messages/index.vue","webpack:///./pages/messages/index.vue?240e","webpack:///./pages/messages/index.vue?f2aa"],"sourcesContent":["// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../../node_modules/sass-resources-loader/lib/loader.js??ref--7-oneOf-1-4!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./split-line.vue?vue&type=style&index=0&lang=scss&\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add CSS to SSR context\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesServer.js\").default\nmodule.exports.__inject__ = function (context) {\n  add(\"10f43ecd\", content, true, context)\n};","export * from \"-!../../../node_modules/vue-style-loader/index.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../../node_modules/sass-resources-loader/lib/loader.js??ref--7-oneOf-1-4!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./split-line.vue?vue&type=style&index=0&lang=scss&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".split-wrapper{display:flex;align-items:center}.split-wrapper .icon{font-size:1.4rem}.split-wrapper .desc{font-size:13px;font-weight:700;padding:0 10px 0 5px;letter-spacing:2px;text-transform:uppercase}.split-wrapper .split{flex:1;height:1px;background-color:var(--border-color)}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"split-wrapper\"},[_vm._ssrNode(((_vm.icon)?(\"<i\"+(_vm._ssrClass(\"icon\",_vm.getIcon(_vm.icon)))+\"></i>\"):\"<!---->\")+\" \"+((_vm.desc)?(\"<span class=\\\"desc\\\">\"+_vm._ssrEscape(_vm._s(_vm.desc))+\"</span>\"):\"<!---->\")+\" <div class=\\\"split\\\"></div>\")])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n    props: {\n        icon: String,\n        desc: String,\n    },\n    methods: {\n        getIcon(icon) {\n            return /icon/.test(icon) ? icon : 'icon-' + icon\n        }\n    }\n}\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js??ref--2-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./split-line.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js??ref--2-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./split-line.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./split-line.vue?vue&type=template&id=1898fbd0&\"\nimport script from \"./split-line.vue?vue&type=script&lang=js&\"\nexport * from \"./split-line.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./split-line.vue?vue&type=style&index=0&lang=scss&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  null,\n  \"36b8099b\"\n  \n)\n\nexport default component.exports","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../../node_modules/sass-resources-loader/lib/loader.js??ref--7-oneOf-1-4!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./comment-editor.vue?vue&type=style&index=0&id=2945e851&lang=scss&scoped=true&\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add CSS to SSR context\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesServer.js\").default\nmodule.exports.__inject__ = function (context) {\n  add(\"30b81a99\", content, true, context)\n};","import Vue from 'vue'\r\nconst isServer = Vue.prototype.$isServer\r\n\r\nexport const on = (function() {\r\n  if (!isServer && document.addEventListener) {\r\n    return function(element, event, handler) {\r\n      if (element && event && handler) {\r\n        element.addEventListener(event, handler, false);\r\n      }\r\n    }\r\n  }\r\n})()\r\n\r\nexport const off = (function() {\r\n  if (!isServer && document.removeEventListener) {\r\n    return function(element, event, handler) {\r\n      if (element && event && handler) {\r\n        element.removeEventListener(event, handler, false);\r\n      }\r\n    }\r\n  }\r\n})()\r\n\r\n\r\n/**\r\n * 获取光标位置\r\n * @param {DOMElement} element 输入框的dom节点\r\n * @return {Number} 光标位置\r\n */\r\nexport const getCursorPosition = (element) => {\r\n  let caretOffset = 0\r\n  const doc = element.ownerDocument || element.document\r\n  const win = doc.defaultView || doc.parentWindow\r\n  const sel = win.getSelection()\r\n  if (sel.rangeCount > 0) {\r\n    const range = win.getSelection().getRangeAt(0)\r\n    const preCaretRange = range.cloneRange()\r\n    preCaretRange.selectNodeContents(element)\r\n    preCaretRange.setEnd(range.endContainer, range.endOffset)\r\n    caretOffset = preCaretRange.toString().length\r\n  }\r\n  return caretOffset\r\n}\r\n\r\n/**\r\n * 设置光标位置\r\n * @param {DOMElement} element 输入框的dom节点\r\n * @param {Number} cursorPosition 光标位置的值\r\n */\r\nexport const setCursorPosition = (element, cursorPosition) => {\r\n  const range = document.createRange()\r\n  if (element.firstChild.length < cursorPosition) {\r\n    return\r\n  }\r\n  range.setStart(element.firstChild, cursorPosition)\r\n  range.setEnd(element.firstChild, cursorPosition)\r\n  const sel = window.getSelection()\r\n  sel.removeAllRanges()\r\n  sel.addRange(range)\r\n}\r\n","import defaultAvatar from '@/assets/image/default.png'\r\nimport Utils from '../utils/util'\r\nimport gravatar from '@/plugins/gravatar'\r\n\r\n/**\r\n * gravatar 头像服务\r\n */\r\nexport default (email) => {\r\n  if (!email) {\r\n    return defaultAvatar\r\n  }\r\n  if (!Utils.validateEmail(email)) {\r\n    return defaultAvatar\r\n  }\r\n  return gravatar.url(email, {\r\n    protocol: 'https'\r\n  })\r\n}\r\n","module.exports = __webpack_public_path__ + \"img/default.8d326fe.png\";","export * from \"-!../../../node_modules/vue-style-loader/index.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../../node_modules/sass-resources-loader/lib/loader.js??ref--7-oneOf-1-4!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./comment-editor.vue?vue&type=style&index=0&id=2945e851&lang=scss&scoped=true&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".fade-transform-enter-active[data-v-2945e851],.fade-transform-leave-active[data-v-2945e851]{transition:all .5s}.fade-transform-enter[data-v-2945e851]{opacity:0;transform:translateX(-30px)}.fade-transform-leave-to[data-v-2945e851]{opacity:0;transform:translateX(30px)}.mobile-slide-enter-active[data-v-2945e851],.mobile-slide-leave-active[data-v-2945e851]{transition:all .2s ease-in-out}.mobile-slide-enter[data-v-2945e851],.mobile-slide-leave-to[data-v-2945e851]{transform:translateX(100%)}.search-slide-enter-active[data-v-2945e851],.search-slide-leave-active[data-v-2945e851]{transition:all .35s ease-in-out}@media (max-width:1024px){.search-slide-enter-active[data-v-2945e851],.search-slide-leave-active[data-v-2945e851]{transition:all .25s ease-in-out}}.search-slide-enter[data-v-2945e851],.search-slide-leave-to[data-v-2945e851]{transform:translateX(100%)}.fade-enter-active[data-v-2945e851],.fade-leave-active[data-v-2945e851]{transition:opacity .3s}.fade-enter[data-v-2945e851],.fade-leave-active[data-v-2945e851]{opacity:0}.fade-move[data-v-2945e851]{transition:transform .3s}.fade-leave-active[data-v-2945e851]{position:absolute}.list-slide-enter[data-v-2945e851],.list-slide-leave-to[data-v-2945e851]{opacity:0;transform:translateY(30px)}.list-slide-leave-active[data-v-2945e851]{width:100%;position:absolute}.slide-up-enter-active[data-v-2945e851]{transition:all .3s ease .1s}.slide-up-leave-active[data-v-2945e851]{transition:all .3s ease}.slide-up-enter[data-v-2945e851],.slide-up-leave-active[data-v-2945e851]{transform:translateY(-20px);opacity:0}.slide-up-move[data-v-2945e851]{transition:all .5s}.editor-container[data-v-2945e851]{display:flex;justify-content:space-between;align-items:flex-start}.avatar[data-v-2945e851]{display:inline-block;width:36px;height:36px;border-radius:50%;background-color:#eee}@media (max-width:480px){.avatar[data-v-2945e851]{display:none}}.slide-wrapper[data-v-2945e851]{position:relative}.message-container .comment-wrapper[data-v-2945e851]{width:100%}.message-container .slide-wrapper[data-v-2945e851]{display:flex;flex-direction:column}.message-container .slide-wrapper .user-item[data-v-2945e851]{order:1;margin:5px 0 10px}@media (max-width:480px){.message-container .slide-wrapper .user-item .user-input[data-v-2945e851]{width:calc(100% - 20px)}}.message-container .slide-wrapper .editor-item[data-v-2945e851]{order:2}.message-container .slide-wrapper .tools-item[data-v-2945e851]{order:3}.comment-wrapper[data-v-2945e851]{width:calc(100% - 50px)}@media (max-width:480px){.comment-wrapper[data-v-2945e851]{width:100%}}.comment-wrapper .list-slide-item[data-v-2945e851]{transition:all .3s ease-in-out}.comment-wrapper .reply-target[data-v-2945e851]{box-sizing:border-box;position:relative;margin-bottom:10px;padding:10px;border:1px solid var(--border-color);border-radius:4px}.comment-wrapper .reply-target .icon-ant-close[data-v-2945e851]{display:flex;justify-content:center;align-items:center;position:absolute;top:5px;right:5px;width:30px;height:30px;font-size:20px;cursor:pointer}.comment-wrapper .reply-target .icon-ant-close[data-v-2945e851]:hover{color:var(--theme-active)}.comment-wrapper .editor[data-v-2945e851]{box-sizing:border-box;width:100%;min-height:6em;max-height:30em;padding:10px;font-size:1rem;color:var(--font-color-article);border:1px solid var(--border-color);border-radius:4px;outline:none;overflow-y:auto;transition:all .1s linear;font-family:Microsoft Yahei}.comment-wrapper .editor[data-v-2945e851]:empty:before{content:attr(placeholder);white-space:pre-wrap}.comment-wrapper .editor dt[data-v-2945e851]:before{content:\\\"\\\\D\\\\A\\\";white-space:pre}.comment-wrapper .editor dt[data-v-2945e851]:first-child:before{content:normal}.comment-wrapper .editor[data-v-2945e851]:focus,.comment-wrapper .editor[data-v-2945e851]:hover{border-color:var(--font-color-light)}.comment-wrapper .editor[data-v-2945e851]:focus:before{content:none}.comment-wrapper .user-wrapper[data-v-2945e851]{display:flex;align-items:center;font-size:1rem}@media (max-width:768px){.comment-wrapper .user-wrapper[data-v-2945e851]{flex-direction:column}}.comment-wrapper .user-wrapper .user-input[data-v-2945e851]{width:calc(32% - 20px);height:1em;margin-right:1em;line-height:normal;padding:8px 10px;outline:none;color:var(--font-color-article);white-space:nowrap;border:1px solid var(--border-color);border-radius:4px;background-color:var(--app-background-color);transition:all .1s linear;-webkit-appearance:none;-webkit-tap-highlight-color:transparent}.comment-wrapper .user-wrapper .user-input[data-v-2945e851]:focus,.comment-wrapper .user-wrapper .user-input[data-v-2945e851]:hover{border-color:var(--font-color-light)}@media (max-width:768px){.comment-wrapper .user-wrapper .user-input[data-v-2945e851]{width:calc(100% - 20px);margin:3px 5px}}.tools-wrapper[data-v-2945e851]{display:flex;justify-content:space-between;align-items:center}.tools-wrapper .tool-item[data-v-2945e851]{display:flex;justify-content:center;align-items:center;width:30px;height:30px;cursor:pointer;transition:all .1s linear}.tools-wrapper .tool-item[data-v-2945e851]:hover{background-color:var(--tool-background-color)}.editor-tools[data-v-2945e851]{display:flex;justify-content:flex-start;transition:all .1s linear;margin:5px 0}.editor-tools>a[data-v-2945e851]{position:relative;margin-right:10px}.editor-tools>a[data-v-2945e851]:last-child{margin-right:0}.emoji-wrapper[data-v-2945e851]{box-sizing:border-box;display:flex;justify-content:flex-start;flex-wrap:wrap;position:absolute;top:30px;left:0;width:200px;padding:10px;background-color:var(--code-background);z-index:1;cursor:default}.emoji-wrapper .emoji-item[data-v-2945e851]{display:flex;justify-content:center;align-items:center;box-sizing:border-box;font-size:20px;width:36px;height:36px}.emoji-wrapper .emoji-item[data-v-2945e851]:hover{background-color:var(--tool-background-color);cursor:pointer}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"editor-container\",class:{'message-container': _vm.isMessageEditor}},[_vm._ssrNode(((!_vm.isMessageEditor)?(\"<img\"+(_vm._ssrAttr(\"src\",_vm.avatar))+(_vm._ssrAttr(\"alt\",_vm.form.nickname || '匿名用户'))+\" class=\\\"avatar\\\" data-v-2945e851>\"):\"<!---->\")+\" \"),_vm._ssrNode(\"<section class=\\\"comment-wrapper\\\" data-v-2945e851>\",\"</section>\",[_c('transition-group',{staticClass:\"slide-wrapper\",attrs:{\"tag\":\"div\",\"name\":\"list-slide\"}},[(_vm.isShowReplyContent)?_c('section',{key:1,staticClass:\"list-slide-item reply-item\"},[_c('div',{staticClass:\"reply-target\"},[_c('i',{staticClass:\"icon icon-ant-close\",on:{\"click\":_vm.closeReplyContent}}),_vm._v(\" \"),_c('strong',{staticClass:\"reply-author\"},[_vm._v(\"@\"+_vm._s(_vm.reply.nickname))]),_vm._v(\" \"),_c('div',{staticClass:\"reply-content markdown\",domProps:{\"innerHTML\":_vm._s(_vm.reply.content)}})])]):_vm._e(),_vm._v(\" \"),_c('section',{key:2,staticClass:\"list-slide-item editor-item\"},[_c('div',{ref:\"editContent\",staticClass:\"editor\",attrs:{\"contenteditable\":\"true\",\"placeholder\":_vm.placeholder || (_vm.isMessageEditor ? '我想说...' : '评论...')},on:{\"keyup\":_vm.contentChange,\"click\":_vm.getCursorPosition}})]),_vm._v(\" \"),_c('section',{key:3,staticClass:\"list-slide-item tools-wrapper tools-item\"},[_c('div',{staticClass:\"editor-tools\"},[_c('a',{directives:[{name:\"click-outside\",rawName:\"v-click-outside\",value:(function () {_vm.isShowEmoji = false}),expression:\"() => {isShowEmoji = false}\"}],staticClass:\"tool-item\",on:{\"click\":function($event){_vm.isShowEmoji = true}}},[_c('i',{staticClass:\"icon icon-smile\"}),_vm._v(\" \"),_c('ul',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isShowEmoji),expression:\"isShowEmoji\"}],staticClass:\"emoji-wrapper\"},_vm._l((_vm.emojiList),function(emoji,index){return _c('li',{key:index,staticClass:\"emoji-item\",on:{\"click\":function($event){$event.stopPropagation();return _vm.insertEmoji(emoji)}}},[_vm._v(\"\\n                                \"+_vm._s(emoji)+\"\\n                            \")])}),0)]),_vm._v(\" \"),_c('a',{staticClass:\"tool-item\",on:{\"click\":function($event){return _vm.insertContent('image')}}},[_c('i',{staticClass:\"icon icon-image\"})]),_vm._v(\" \"),_c('a',{staticClass:\"tool-item\",on:{\"click\":function($event){return _vm.insertContent('link')}}},[_c('i',{staticClass:\"icon icon-link\"})]),_vm._v(\" \"),_c('a',{staticClass:\"tool-item\",on:{\"click\":function($event){return _vm.insertContent('code')}}},[_c('i',{staticClass:\"icon icon-code\"})])]),_vm._v(\" \"),_c('a',{staticClass:\"tool-item\",on:{\"click\":_vm.debouncedSend}},[_c('i',{staticClass:\"icon icon-send\"})])]),_vm._v(\" \"),_c('div',{key:4,staticClass:\"list-slide-item user-item\"},[_c('section',{staticClass:\"user-wrapper\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.form.nickname),expression:\"form.nickname\"}],staticClass:\"user-input\",attrs:{\"maxlength\":\"32\",\"name\":\"text\",\"required\":true,\"type\":\"text\",\"placeholder\":\"昵称（必填）\"},domProps:{\"value\":(_vm.form.nickname)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.form, \"nickname\", $event.target.value)}}}),_vm._v(\" \"),_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.form.email),expression:\"form.email\"}],staticClass:\"user-input\",attrs:{\"name\":\"email\",\"type\":\"email\",\"placeholder\":\"邮箱（必填）\"},domProps:{\"value\":(_vm.form.email)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.form, \"email\", $event.target.value)}}})])])])],1)],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {debounce} from 'throttle-debounce'\nimport Uitls from '@/services/utils/util'\nimport ClickOutside from '@/services/directives/click-outside'\nimport {getCursorPosition, setCursorPosition} from '@/services/utils/dom'\nimport gravatar from '@/services/gravatar/gravatar'\n\nconst emojiList = [\n    '😃', '😂', '😅', '😉', '😌', '😔', '😓', '😘', '😡', '😭', '😱', '😳', '😵',\n    '🌚', '👍', '👎', '💪', '🌹', '💊'\n]\n\nexport default {\n    props: {\n        placeholder: {\n            type: String\n        },\n        isShowReplyContent: {\n            type: Boolean,\n            default: false\n        },\n\n        isMessageEditor: {\n            type: Boolean,\n            default: false\n        }\n    },\n\n    data() {\n        return {\n            isShowEmoji: false,\n            contentText: '',\n            contentHtml: '',\n            form: {\n                nickname: '',\n                content: '',\n                email: ''\n            },\n            reply: {\n                replyNickname: '',\n                replyContent: '',\n            },\n            emojiList,\n            cursorPosition: 0,\n        }\n    },\n\n    directives: {\n        ClickOutside\n    },\n\n    computed: {\n        avatar() {\n            return gravatar(this.form.email)\n        }\n    },\n\n    methods: {\n        // 重置为空\n        resetField() {\n            this.form.content = ''\n            this.contentText = ''\n            this.contentHtml = ''\n            this.$refs.editContent.innerHTML = ''\n            this.$refs.editContent.innerText = ''\n            this.cursorPosition = 0\n        },\n\n        closeReplyContent() {\n            this.$emit(\"closeReplyContent\");\n        },\n\n        contentChange() {\n            const html = this.$refs.editContent.innerHTML\n            const text = this.$refs.editContent.innerText\n            if (!Object.is(html, this.comemntContentHtml)) {\n                this.contentHtml = html\n            }\n            if (!Object.is(text, this.comemntContentText)) {\n                this.contentText = text\n            }\n            this.cursorPosition = getCursorPosition(this.$refs.editContent)\n        },\n\n        getCursorPosition() {\n            this.cursorPosition = getCursorPosition(this.$refs.editContent)\n        },\n\n        send() {\n            this.contentChange()\n            const inValidMsg = this.getInValidMsg()\n            if (inValidMsg) {\n                alert(inValidMsg)\n                return\n            }\n            if (process.client) {\n                const user = {\n                    nickname: this.form.nickname,\n                    email: this.form.email,\n                    website: this.form.website,\n                }\n                window.localStorage.setItem('USER', JSON.stringify(user))\n            }\n            this.$emit('send', this.form)\n        },\n\n        getInValidMsg() {\n            this.form.content = this.contentText\n            if (!this.form.email) {\n                return '邮箱不能为空'\n            }\n            if (Uitls.validateEmail(this.form.email) === false) {\n                return '请填写正确的email格式'\n            }\n            /*if (this.form.website && Uitls.validateUrl(this.form.website) === false) {\n                return '请填写正确的url格式'\n            }*/\n            if (!this.form.content || !this.form.content.replace(/\\s/g, '')) {\n                if (this.form.content.length > 1000 || this.form.content.split('\\n').length > 30) {\n                    return `${this.isMessageEditor ? '留言' : '评论'}内容不能超过1000个字且控制在30行以内`\n                }\n                return this.isMessageEditor ? '留言内容不能为空' : '评论内容不能为空'\n            }\n            if (!this.form.nickname || this.form.nickname.length > 32) {\n                return '昵称不能为空且长度不能超过32个字符'\n            }\n            return false\n        },\n\n        insertContent(type) {\n            const contents = {\n                image: {\n                    start: `![`,\n                    end: `]()`\n                },\n                link: {\n                    start: `[`,\n                    end: `]()`,\n                },\n                code: {\n                    start: '\\n```\\n',\n                    end: '\\n```',\n                }\n            }\n            this.updateEditContent(contents[type])\n        },\n\n        insertEmoji(emoji) {\n            const editor = this.$refs.editContent\n            const text = editor.innerText\n            // 插入 emoji\n            editor.innerText = text.slice(0, this.cursorPosition) + `${emoji}` + text.slice(this.cursorPosition, text.length)\n            // 光标位置后挪一位，以保证在刚插入的 emoji 后面\n            setCursorPosition(editor, this.cursorPosition + 2)\n            // 更新本地保存的光标位置变量（注意 emoji 占两个字节大小，所以要加1）\n            this.cursorPosition = getCursorPosition(editor) + 2 // emoji 占两位\n            this.contentChange()\n        },\n\n\n        updateEditContent({start = '', end = ''}) {\n            if (!start && !end) {\n                return\n            }\n            const editor = this.$refs.editContent\n            const selectedText = (window.getSelection || document.getSelection)().toString()\n            const currentText = editor.innerText\n            if (selectedText) {\n                const newText = currentText.replace(selectedText, start + selectedText + end)\n                editor.innerText = newText\n            } else {\n                editor.innerText = editor.innerText += (start + end)\n            }\n        }\n    },\n\n    created() {\n        // 发送防抖\n        this.debouncedSend = debounce(1000, true, () => {\n            this.send()\n        })\n        if (process.client) {\n            let user = window.localStorage.getItem('USER')\n            if (user) {\n                user = JSON.parse(user)\n                this.form.nickname = user.nickname || ''\n                this.form.email = user.email || ''\n                this.form.website = user.website || ''\n            }\n        }\n    }\n};\n","import mod from \"-!../../../node_modules/babel-loader/lib/index.js??ref--2-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./comment-editor.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js??ref--2-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./comment-editor.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./comment-editor.vue?vue&type=template&id=2945e851&scoped=true&\"\nimport script from \"./comment-editor.vue?vue&type=script&lang=js&\"\nexport * from \"./comment-editor.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./comment-editor.vue?vue&type=style&index=0&id=2945e851&lang=scss&scoped=true&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"2945e851\",\n  \"28bc8d9b\"\n  \n)\n\nexport default component.exports","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../node_modules/sass-resources-loader/lib/loader.js??ref--7-oneOf-1-4!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=37e2d702&lang=scss&scoped=true&\");\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add CSS to SSR context\nvar add = require(\"!../../node_modules/vue-style-loader/lib/addStylesServer.js\").default\nmodule.exports.__inject__ = function (context) {\n  add(\"2551f70a\", content, true, context)\n};","export * from \"-!../../node_modules/vue-style-loader/index.js??ref--7-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--7-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../node_modules/sass-resources-loader/lib/loader.js??ref--7-oneOf-1-4!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=37e2d702&lang=scss&scoped=true&\"","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".reply-wrapper[data-v-37e2d702]{box-sizing:border-box;padding:6px 10px;font-size:14px;border:1px solid var(--border-color);border-radius:4px;background-color:var(--primary-light-0)}.reply-wrapper .reply-nickname[data-v-37e2d702]{font-weight:700}.messages-container[data-v-37e2d702]{width:100%;max-width:1200px;margin:0 auto;z-index:1;box-sizing:border-box}@media (max-width:1440px){.messages-container[data-v-37e2d702]{padding:0 85px}}@media (max-width:1024px){.messages-container[data-v-37e2d702]{padding:0 60px}}@media (max-width:768px){.messages-container[data-v-37e2d702]{padding:0 35px}}@media (max-width:480px){.messages-container[data-v-37e2d702]{padding:0 15px}}.messages-container .editor-wrapper[data-v-37e2d702]{margin:.5em}.messages-wrapper[data-v-37e2d702]{display:flex;flex-wrap:wrap}.messages-wrapper .message-item[data-v-37e2d702]{display:flex;flex-direction:column;width:100%;margin:.4em .5em;padding:1em;border-radius:4px;transition:all .25s ease-in-out;border:1px solid var(--border-color)}@media (max-width:480px){.messages-wrapper .message-item[data-v-37e2d702]{margin:.2em .5em;padding:.5em}}.messages-wrapper .message-item[data-v-37e2d702]:hover{transform:translateY(-2px)}.messages-wrapper .message-item .nickname[data-v-37e2d702]{height:24px;font-size:14px;font-weight:700}.messages-wrapper .message-item .content[data-v-37e2d702]{flex:1;font-size:14px}.messages-wrapper .message-item .content img[data-v-37e2d702]{width:50%}.messages-wrapper .message-item .time[data-v-37e2d702]{font-size:14px;text-align:right}.load-more[data-v-37e2d702]{box-sizing:border-box;width:40px;height:40px;margin:10px auto 0;border:8px solid #dcdfe7;border-radius:50%;transition:all .25s ease-in-out;cursor:pointer}@media (max-width:480px){.load-more[data-v-37e2d702]{width:30px;height:30px;border-width:5px}}.load-more[data-v-37e2d702]:hover{border-color:var(--theme-active);background-color:var(--theme-active);transform:scale(.65)}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"messages-container\"},[_c('split-line',{attrs:{\"icon\":'message',\"desc\":'留言墙'}}),_vm._ssrNode(\" \"),_vm._ssrNode(\"<section class=\\\"editor-wrapper\\\" data-v-37e2d702>\",\"</section>\",[_c('comment-editor',{ref:\"editor\",attrs:{\"isMessageEditor\":true},on:{\"send\":_vm.onSend}})],1),_vm._ssrNode(\" <ul class=\\\"messages-wrapper markdown\\\" data-v-37e2d702>\"+(_vm._ssrList((_vm.messages),function(message){return (\"<li class=\\\"message-item\\\" data-v-37e2d702>\"+((message.nickname)?(\"<span class=\\\"nickname\\\" data-v-37e2d702>\"+_vm._ssrEscape(_vm._s(message.nickname))+\"</span>\"):\"<!---->\")+\" <div class=\\\"content\\\" data-v-37e2d702><p data-v-37e2d702>\"+(_vm._s(_vm.marked(message.content)))+\"</p> \"+((message.reply)?(\"<section class=\\\"reply-wrapper markdown\\\" data-v-37e2d702><div class=\\\"reply-nickname\\\" data-v-37e2d702><i class=\\\"iconfont iconzuozhe\\\" data-v-37e2d702></i>：</div> <div data-v-37e2d702>\"+(_vm._s(_vm.marked(message.reply)))+\"</div></section>\"):\"<!---->\")+\"</div> <time\"+(_vm._ssrAttr(\"datetime\",_vm._f(\"filterTime\")(message.create_time)))+\" class=\\\"time\\\" data-v-37e2d702>\"+_vm._ssrEscape(_vm._s(_vm._f(\"filterTime\")(message.create_time))+\"\\n            \")+\"</time></li>\")}))+\"</ul> <div class=\\\"load-more\\\"\"+(_vm._ssrStyle(null,null, { display: (_vm.isLoadMore) ? '' : 'none' }))+\" data-v-37e2d702></div> \"),_c('loading',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.loading),expression:\"loading\"}]}),_vm._ssrNode(\" \"),(!_vm.loading && !_vm.messages.length)?_c('empty',{attrs:{\"message\":'还没有留言 /(ㄒoㄒ)/~~',\"isBack\":false}}):_vm._e()],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport SplitLine from '@/components/base/split-line/split-line'\nimport CommentEditor from '@/components/base/comment-editor/comment-editor'\nimport markdown from '@/plugins/marked'\nimport {mapState} from 'vuex'\n\nexport default {\n    name: 'messages-page',\n\n    components: {\n        SplitLine,\n        CommentEditor\n    },\n\n    head() {\n        return {\n            title: '留言墙'\n        }\n    },\n\n    async fetch({store, params}) {\n        await store.dispatch('message/getMessages', {\n            page: 0,\n            count: 10\n        })\n    },\n\n    data() {\n        return {\n            page: 0\n        }\n    },\n\n    computed: {\n        ...mapState({\n            messages: state => state.message.messages,\n            total: state => state.message.total,\n            loading: state => state.message.loading\n        }),\n\n        isLoadMore() {\n            if (this.messages.length && !this.loading) {\n                return this.total > this.messages.length\n            } else {\n                return false\n            }\n        }\n    },\n\n    watch: {\n        messages() {\n            this.$nextTick(() => {\n                this.initImage()\n            })\n        }\n    },\n\n    methods: {\n        // markdown 解析\n        marked(content) {\n            return markdown(content)\n        },\n\n        loadMore() {\n            if (this.loading) {\n                return\n            }\n            this.page++\n            this.$store.dispatch('message/getMoreMessages', {\n                page: this.page\n            })\n        },\n\n        initImage() {\n            import('../../services/utils/lazy-img').then(res => {\n                res.default('.image-popper')\n            })\n        },\n\n        async onSend({nickname, content,email}) {\n            try {\n                const res = await this.$store.dispatch('message/createMessage', {\n                    nickname,\n                    email,\n                    content\n                })\n                if (res && res.code === 1) {\n                    this.$refs.editor.resetField()\n                    this.$store.dispatch('message/getMessages', {\n                        page: 0,\n                        count:10\n                    })\n                }\n            } catch (e) {\n                // eslint-disable-next-line no-console\n                console.log(e)\n            }\n        }\n    },\n\n    mounted() {\n        this.initImage()\n    }\n}\n","import mod from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/babel-loader/lib/index.js??ref--2-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=37e2d702&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  var style0 = require(\"./index.vue?vue&type=style&index=0&id=37e2d702&lang=scss&scoped=true&\")\nif (style0.__inject__) style0.__inject__(context)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"37e2d702\",\n  \"73ba07a6\"\n  \n)\n\nexport default component.exports"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACVA;AAAA;AAAA;AAAA;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACNA;AACA;AACA;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAJA;AALA;;ACTA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AC3DA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AADA;AAGA;;;;;;;ACjBA;;;;;;;;ACAA;AAAA;AAAA;AAAA;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACNA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAKA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAFA;AAKA;AACA;AACA;AAFA;AATA;AACA;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAFA;AAIA;AACA;AAdA;AAgBA;AACA;AACA;AACA;AADA;AAIA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA,mBAOA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AADA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AATA;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArHA;AACA;AAsHA;AACA;AACA;AACA;AACA;AACA;AAAA,iBAQA;AACA;AACA;AAnLA;;AC/FA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;ACVA;AAAA;AAAA;AAAA;;;;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACNA;AACA;AACA;;;;;;;;;;;;;;;;;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAFA;AACA;AAIA;AACA;AACA;AADA;AAGA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AAEA;AACA;AACA;AAHA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAdA;AAgBA;AACA;AACA;AACA;AACA;AACA;AACA;AANA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAHA;AACA;AAIA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAIA;AACA;AAzCA;AACA;AA0CA;AACA;AACA;AACA;AAjGA;;ACjCA;;;;;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}